<source>
  @type tail
  path /app/logs/*.log
  pos_file /fluentd/log/fastapi.pos
  tag api_service.logs
  <parse>
    @type multi_format
    <pattern>
      format json
    </pattern>
    <pattern>
      format multiline
      format_firstline /^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3} \+\d{4} \w+/
      format1 /(?<message>.*)/
    </pattern>
  </parse>
</source>

<match api_service.logs>
  @type elasticsearch
  host elasticsearch
  port 9200
  logstash_format true
  reload_connections false
  retry_limit 10
  retry_wait 5s
</match>
